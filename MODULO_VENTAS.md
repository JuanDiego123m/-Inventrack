# üõí M√≥dulo de Procesar Ventas

## üìã Descripci√≥n General

El m√≥dulo de Procesar Ventas permite a los usuarios registrar y procesar ventas de productos del inventario de manera intuitiva y eficiente. Este m√≥dulo implementa un carrito de compras funcional que actualiza autom√°ticamente el inventario al procesar cada venta.

## üéØ Funcionalidades

### ‚úÖ **Funcionalidades Principales**

1. **Selecci√≥n de Productos**
   - ComboBox con lista de productos disponibles
   - Muestra c√≥digo, nombre y stock de cada producto
   - Solo muestra productos con stock disponible (cantidad > 0)

2. **Gesti√≥n del Carrito**
   - Agregar productos con cantidad personalizada
   - Ver productos agregados en tabla interactiva
   - Quitar productos del carrito
   - Limpiar todo el carrito
   - Actualizaci√≥n autom√°tica de cantidades si se agrega el mismo producto

3. **C√°lculo Autom√°tico**
   - Subtotal por producto (precio √ó cantidad)
   - Total general de la venta
   - Resumen con cantidad de items y unidades

4. **Validaciones**
   - Verificaci√≥n de stock disponible
   - No permite cantidades mayores al stock
   - Validaci√≥n de productos seleccionados
   - Confirmaci√≥n antes de procesar venta

5. **Procesamiento de Venta**
   - Guarda la venta en la base de datos
   - Actualiza autom√°ticamente el inventario
   - Genera ID √∫nico de venta
   - Registra fecha y hora
   - Asocia la venta con el usuario vendedor

## üèóÔ∏è Arquitectura

### **Componentes del M√≥dulo**

```
Modelo (Model)
‚îú‚îÄ‚îÄ Venta.java - Entidad principal de venta
‚îú‚îÄ‚îÄ ItemVenta.java - Items individuales de la venta
‚îî‚îÄ‚îÄ Producto.java - Informaci√≥n de productos

Vista (View)
‚îî‚îÄ‚îÄ VentaFrame.java - Interfaz gr√°fica del m√≥dulo

Controlador (Controller)
‚îî‚îÄ‚îÄ VentaController.java - L√≥gica de negocio

Servicio (Service)
‚îî‚îÄ‚îÄ VentaService.java - Operaciones de ventas

DAO (Data Access Object)
‚îî‚îÄ‚îÄ VentaDAO.java - Acceso a datos de ventas
```

## üìä Base de Datos

### **Tabla: ventas**
```sql
CREATE TABLE ventas (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    usuario_id INTEGER NOT NULL,
    total DECIMAL(10,2) NOT NULL,
    fecha_venta DATETIME DEFAULT CURRENT_TIMESTAMP,
    activo BOOLEAN DEFAULT TRUE,
    FOREIGN KEY (usuario_id) REFERENCES usuarios(id)
);
```

### **Tabla: items_venta**
```sql
CREATE TABLE items_venta (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    venta_id INTEGER NOT NULL,
    producto_id INTEGER NOT NULL,
    cantidad INTEGER NOT NULL,
    precio_unitario DECIMAL(10,2) NOT NULL,
    subtotal DECIMAL(10,2) NOT NULL,
    FOREIGN KEY (venta_id) REFERENCES ventas(id),
    FOREIGN KEY (producto_id) REFERENCES productos(id)
);
```

## üíª Interfaz de Usuario

### **Dise√±o Moderno**

La interfaz utiliza un dise√±o moderno y profesional con:

- **Colores Corporativos**
  - Primario (Azul): `#2980b9`
  - √âxito (Verde): `#2ecc71`
  - Peligro (Rojo): `#e74c3c`
  - Advertencia (Amarillo): `#f1c40f`

- **Componentes Principales**
  1. **Panel Superior**: T√≠tulo y usuario actual
  2. **Panel de Productos**: Selecci√≥n y cantidad
  3. **Tabla del Carrito**: Vista de items agregados
  4. **Panel de Resumen**: Informaci√≥n y total
  5. **Botones de Acci√≥n**: Procesar, Cancelar

### **Tabla del Carrito**

| Columna | Descripci√≥n |
|---------|-------------|
| **Producto** | C√≥digo y nombre del producto |
| **Precio Unit.** | Precio unitario formateado |
| **Cantidad** | Unidades a vender |
| **Subtotal** | Total por producto |

## üîÑ Flujo de Trabajo

### **Proceso de Venta**

```
1. Usuario abre "Procesar Venta"
   ‚Üì
2. Sistema carga productos disponibles
   ‚Üì
3. Usuario selecciona producto y cantidad
   ‚Üì
4. Usuario hace clic en "Agregar al Carrito"
   ‚Üì
5. Sistema valida stock disponible
   ‚Üì
6. Producto se agrega a la tabla
   ‚Üì
7. Se actualiza el total autom√°ticamente
   ‚Üì
8. Usuario repite pasos 3-7 seg√∫n necesite
   ‚Üì
9. Usuario hace clic en "Procesar Venta"
   ‚Üì
10. Sistema solicita confirmaci√≥n
    ‚Üì
11. Usuario confirma
    ‚Üì
12. Sistema guarda venta en BD
    ‚Üì
13. Sistema actualiza inventario
    ‚Üì
14. Muestra mensaje de √©xito con ID de venta
    ‚Üì
15. Carrito se limpia autom√°ticamente
```

## üîê Permisos y Acceso

### **Roles con Acceso**

- ‚úÖ **SUPER_ADMIN** - Acceso completo
- ‚úÖ **ADMIN** - Acceso completo
- ‚úÖ **VENDEDOR** - Acceso completo
- ‚úÖ **CONSULTA** - Solo visualizaci√≥n

### **Restricciones**

- Solo usuarios autenticados pueden procesar ventas
- Cada venta queda asociada al usuario que la proces√≥
- No se puede eliminar una venta procesada (auditor√≠a)

## üìù Ejemplos de Uso

### **Ejemplo 1: Venta Simple**

```java
// El usuario selecciona:
Producto: PROD001 - Laptop HP (Stock: 5)
Cantidad: 2

// Sistema calcula:
Precio Unitario: $2,500,000
Subtotal: $5,000,000
Total Venta: $5,000,000

// Al procesar:
‚úÖ Venta #1 registrada
‚úÖ Stock actualizado: 5 ‚Üí 3 unidades
```

### **Ejemplo 2: Venta M√∫ltiple**

```java
// El usuario agrega varios productos:
1. Laptop HP √ó 1 = $2,500,000
2. iPhone 13 √ó 2 = $7,000,000
3. Camiseta Nike √ó 5 = $425,000

// Total: $9,925,000

// Al procesar:
‚úÖ Venta #2 registrada con 3 items
‚úÖ Inventario actualizado para los 3 productos
```

## ‚ö†Ô∏è Validaciones Implementadas

### **Validaciones de Negocio**

1. ‚úÖ **Stock Suficiente**
   ```
   Si cantidad solicitada > stock disponible:
     ‚Üí Mostrar error "Stock insuficiente"
   ```

2. ‚úÖ **Producto Seleccionado**
   ```
   Si no hay producto seleccionado:
     ‚Üí Mostrar error "Seleccione un producto"
   ```

3. ‚úÖ **Carrito No Vac√≠o**
   ```
   Si carrito est√° vac√≠o al procesar:
     ‚Üí Mostrar error "El carrito est√° vac√≠o"
   ```

4. ‚úÖ **Confirmaci√≥n de Venta**
   ```
   Antes de procesar:
     ‚Üí Solicitar confirmaci√≥n con resumen
   ```

## üé® Caracter√≠sticas de UX

### **Elementos de Experiencia de Usuario**

1. **Feedback Visual**
   - Colores seg√∫n tipo de acci√≥n
   - Hover effects en botones
   - Mensajes claros de √©xito/error

2. **Informaci√≥n en Tiempo Real**
   - Stock actualizado en combo
   - Total calculado autom√°ticamente
   - Resumen din√°mico

3. **Navegaci√≥n Intuitiva**
   - Flujo lineal claro
   - Botones con iconos descriptivos
   - Mensajes de confirmaci√≥n

4. **Prevenci√≥n de Errores**
   - Validaciones en tiempo real
   - Confirmaciones antes de acciones cr√≠ticas
   - Mensajes de ayuda contextuales

## üîß M√©todos Principales

### **VentaController.java**

```java
// Carga productos disponibles
public void cargarProductosDisponibles()

// Agrega producto al carrito
public void agregarProducto()

// Quita producto seleccionado
public void quitarProductoSeleccionado()

// Limpia todo el carrito
public void limpiarCarrito()

// Procesa la venta final
public void procesarVenta()

// Calcula total de la venta
private void calcularTotal()
```

### **VentaService.java**

```java
// Procesa venta completa (guarda y actualiza inventario)
public boolean procesarVenta(Venta venta)

// Obtiene todas las ventas
public List<Venta> obtenerTodasVentas()

// Obtiene venta por ID
public Venta obtenerVentaPorId(int id)

// Obtiene ventas por fecha
public List<Venta> obtenerVentasPorFecha(LocalDate fecha)

// Obtiene total de ventas del d√≠a
public double obtenerTotalVentasDelDia()
```

## üìà Estad√≠sticas y Reportes

### **Datos Disponibles**

El m√≥dulo prepara los datos para reportes futuros:

- **Total de ventas por d√≠a/mes/a√±o**
- **Ventas por usuario (vendedor)**
- **Productos m√°s vendidos**
- **Ingresos generados**
- **Promedio de venta**
- **Historial completo de transacciones**

## üöÄ C√≥mo Usar el M√≥dulo

### **Paso 1: Acceder**
```
Men√∫ Principal ‚Üí Procesar Ventas
O
Bot√≥n "üõí Procesar Ventas" en panel principal
```

### **Paso 2: Agregar Productos**
```
1. Seleccionar producto del combo
2. Ajustar cantidad con spinner
3. Clic en "‚ûï Agregar al Carrito"
4. Repetir para m√°s productos
```

### **Paso 3: Revisar Carrito**
```
- Ver productos en tabla
- Verificar cantidades
- Quitar items si es necesario
- Revisar total
```

### **Paso 4: Procesar Venta**
```
1. Clic en "üí∞ Procesar Venta"
2. Confirmar en di√°logo
3. Esperar mensaje de √©xito
4. Listo! Inventario actualizado
```

## ‚ö° Caracter√≠sticas T√©cnicas

### **Transacciones**

- ‚úÖ Uso de transacciones SQL
- ‚úÖ Rollback en caso de error
- ‚úÖ Integridad referencial garantizada

### **Optimizaci√≥n**

- ‚úÖ Consultas eficientes con √≠ndices
- ‚úÖ Carga lazy de items de venta
- ‚úÖ Cach√© de productos disponibles

### **Seguridad**

- ‚úÖ Prepared Statements (prevenci√≥n SQL Injection)
- ‚úÖ Validaci√≥n de permisos
- ‚úÖ Auditor√≠a de operaciones

## üêõ Manejo de Errores

### **Errores Comunes**

| Error | Causa | Soluci√≥n |
|-------|-------|----------|
| Stock insuficiente | Cantidad > disponible | Reducir cantidad |
| Producto no seleccionado | No hay selecci√≥n en combo | Seleccionar producto |
| Carrito vac√≠o | Sin items al procesar | Agregar productos |
| Error de BD | Problema de conexi√≥n | Reintentar operaci√≥n |

## üì¶ Dependencias

### **Clases Relacionadas**

- `VentaFrame.java` - Interfaz gr√°fica
- `VentaController.java` - L√≥gica de negocio
- `VentaService.java` - Servicios
- `VentaDAO.java` - Acceso a datos
- `Venta.java` - Modelo de venta
- `ItemVenta.java` - Modelo de item
- `Producto.java` - Modelo de producto
- `Usuario.java` - Modelo de usuario

## üéØ Pr√≥ximas Mejoras

### **Funcionalidades Futuras**

1. ‚è≥ **M√©todo de Pago**
   - Efectivo
   - Tarjeta
   - Transferencia

2. ‚è≥ **Descuentos**
   - Porcentaje
   - Monto fijo
   - Cupones

3. ‚è≥ **Impuestos**
   - IVA
   - Otros impuestos

4. ‚è≥ **Facturaci√≥n**
   - Generaci√≥n autom√°tica de factura
   - Impresi√≥n
   - Env√≠o por email

5. ‚è≥ **Devoluciones**
   - Registro de devoluciones
   - Reintegro al inventario
   - Notas de cr√©dito

## ‚úÖ Testing

### **Casos de Prueba**

1. ‚úÖ Agregar producto con stock suficiente
2. ‚úÖ Intentar agregar producto sin stock
3. ‚úÖ Agregar mismo producto m√∫ltiples veces
4. ‚úÖ Quitar producto del carrito
5. ‚úÖ Limpiar carrito completo
6. ‚úÖ Procesar venta exitosa
7. ‚úÖ Verificar actualizaci√≥n de inventario
8. ‚úÖ Cancelar venta sin procesar

## üì± Responsividad

- ‚úÖ Ventana redimensionable
- ‚úÖ Componentes adaptables
- ‚úÖ Tabla con scroll autom√°tico
- ‚úÖ Layout flexible

## üéì Conceptos Aplicados

### **Patrones de Dise√±o**

- ‚úÖ MVC (Model-View-Controller)
- ‚úÖ DAO (Data Access Object)
- ‚úÖ Singleton (DatabaseManager)

### **Principios SOLID**

- ‚úÖ Single Responsibility
- ‚úÖ Open/Closed
- ‚úÖ Dependency Inversion

### **Buenas Pr√°cticas**

- ‚úÖ Separaci√≥n de responsabilidades
- ‚úÖ C√≥digo limpio y legible
- ‚úÖ Manejo de excepciones
- ‚úÖ Validaciones robustas

---

## üéâ Conclusi√≥n

El m√≥dulo de Procesar Ventas es un sistema completo y robusto que permite:

- ‚úÖ **Registrar ventas** de manera r√°pida y eficiente
- ‚úÖ **Actualizar inventario** autom√°ticamente
- ‚úÖ **Mantener auditor√≠a** de todas las transacciones
- ‚úÖ **Proporcionar datos** para reportes y an√°lisis

El sistema est√° **completamente funcional** y listo para uso en producci√≥n!

---

**Desarrollado por:** Equipo de Desarrollo  
**M√≥dulo:** Procesar Ventas  
**Versi√≥n:** 1.0.0  
**Estado:** ‚úÖ Completado y Funcional
